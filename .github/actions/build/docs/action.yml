name: 'build-docs'
description: 'Builds the docs using mkdocs'
inputs:
  docs-path:
    description: "The path to the docs directory"
    required: false
    default: docs
outputs:
  artifact-path:
    description: "The generated docs artifact filepath"
    value: ${{ steps.export-artifact.outputs.artifact-path }}
runs:
  using: "composite"
  steps:
    - id: get-config
      shell: bash
      run: | 
        echo "site-dir=$(grep -oP "site_dir: '\K.+'" ${{ inputs.docs-path }}/mkdocs.yml | head -c-2)" >> $GITHUB_OUTPUT
    - id: build-mkdocs
      shell: bash
      run: (cd ${{ inputs.docs-path }}; mkdocs build)
    - id: bundle-coverage
      uses: actions/download-artifact@v3
      continue-on-error: true
      with:
        name: coverage-report
        path: ${{ inputs.docs-path }}/${{ steps.get-config.outputs.site-dir }}/dev/coverage
    - id: export-artifact
      shell: bash
      run: echo "artifact-path=${{ inputs.docs-path }}/${{ steps.get-config.outputs.site-dir }}" >> $GITHUB_OUTPUT