name: 'Event: Push to {main}'
# Upon receiving a push to main, this workflow will deploy the main branch to the beta or production channel

on: 
  push:
    branches: # Run on every push to main
      - 'main'
    tags-ignore:
      - '**'

jobs:

  create-coverage-report:
    name: create-coverage-report
    uses: ./.github/workflows/artifacts_test.yml
    with:
      methods: '["unit"]' # Get coverage report

  build-artifacts:
    name: build-artifacts
    uses: ./.github/workflows/artifacts_build.yml
    with:
      artifacts: '["docker", "wiki", "app", "changelog", "docs"]'

  test-artifacts:
    name: test-artifacts
    uses: ./.github/workflows/artifacts_test.yml
    with:
      methods: '["e2e"]'
    
  deploy-artifacts:
    name: deploy-artifacts
    uses: ./.github/workflows/artifacts_deploy.yml
    with:
      targets: '["npm", "docker"]'